orbs:
  maven: circleci/maven@1.3.0
  codecov: codecov/codecov@3.1.1
version: 2.1
machine:
  java:
    version: 'oraclejdk8'
    
jobs:
  build-and-test:
    # These next lines define a Docker executor: https://circleci.com/docs/2.0/executor-types/
    # You can specify an image from Dockerhub or use one of our Convenience Images from CircleCI's Developer Hub.
    # Be sure to update the Docker image tag below to openjdk version of your application.
    # A list of available CircleCI Docker Convenience Images are available here: https://circleci.com/developer/images/image/cimg/openjdk
    docker:
      - image: cimg/openjdk:11.0
    # Add steps to the job
    # See: https://circleci.com/docs/2.0/configuration-reference/#steps
    steps:
      # Checkout the code as the first step.
      - checkout
      # Use mvn clean and package as the standard maven build phase
      - run:
          name: Build
          command: mvn -B -DskipTests clean package
      # Then run your tests!
      - run:
          name: Test
          command: mvn test

      - run:
          name: Code Coverage
          command: curl -Os https://uploader.codecov.io/latest/linux/codecov; chmod +x codecov; ./codecov
build-and-publish:
    jobs:
      - publish:   
          filters:
            branches:
              only: master


steps:
  - run:
      name: test
      command: test
  - codecov/upload:
          file: {{ coverage_report_filepath }}


workflows:
  maven_test:
    jobs:
      - maven/test:
          command: '-X verify'
 
      


